From fb1638d1dc16fb408944fda299d53651b6841df2 Mon Sep 17 00:00:00 2001
From: Marek Vasut <marex@denx.de>
Date: Mon, 25 Jul 2022 14:21:17 +0200
Subject: [PATCH 60/60] arm64: dts: imx8mp: Adjust DT to match downstream DTSI

The downstream kernel fork DTSI contain various differently named nodes
and custom properties, adjust the mainline DT to match the downstream
DTSI.

Upstream-Status: Inappropriate
Signed-off-by: Marek Vasut <marex@denx.de>
---
 ...m-pdk2-overlay-505-200-x12-ch101olhlwh.dts |  27 ++--
 .../imx8mp-dhcom-pdk2-overlay-560-200-x12.dts |   8 ++
 .../boot/dts/freescale/imx8mp-dhcom-pdk2.dts  | 124 +++++++++++++++++-
 .../boot/dts/freescale/imx8mp-dhcom-som.dtsi  |  19 +--
 4 files changed, 156 insertions(+), 22 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/imx8mp-dhcom-pdk2-overlay-505-200-x12-ch101olhlwh.dts b/arch/arm64/boot/dts/freescale/imx8mp-dhcom-pdk2-overlay-505-200-x12-ch101olhlwh.dts
index 19a35fb317ffb..224dd0c4a0c20 100644
--- a/arch/arm64/boot/dts/freescale/imx8mp-dhcom-pdk2-overlay-505-200-x12-ch101olhlwh.dts
+++ b/arch/arm64/boot/dts/freescale/imx8mp-dhcom-pdk2-overlay-505-200-x12-ch101olhlwh.dts
@@ -24,22 +24,31 @@ led-2 {
 };
 
 &lcdif2 {
-	assigned-clock-rates = <500000000>, <500000000>, <200000000>;
 	status = "okay";
 };
 
-&ldb_lvds_ch0 {
-	remote-endpoint = <&panel_in>;
-};
-
-&lvds_ldb {
+&ldb {
 	status = "okay";
+
+	lvds-channel@0 {
+		fsl,data-mapping = "spwg";
+		fsl,data-width = <24>;
+		status = "okay";
+
+		port@1 {
+			reg = <1>;
+
+			lvds_out: endpoint {
+				remote-endpoint = <&panel_in>;
+			};
+		};
+	};
 };
 
-&media_blk_ctrl {
-	assigned-clock-rates = <0>, <0>, <500000000>;
+&ldb_phy {
+	status = "okay";
 };
 
 &panel_in {
-	remote-endpoint = <&ldb_lvds_ch0>;
+	remote-endpoint = <&lvds_out>;
 };
diff --git a/arch/arm64/boot/dts/freescale/imx8mp-dhcom-pdk2-overlay-560-200-x12.dts b/arch/arm64/boot/dts/freescale/imx8mp-dhcom-pdk2-overlay-560-200-x12.dts
index 0d5736e898b5e..78e0817d85c8d 100644
--- a/arch/arm64/boot/dts/freescale/imx8mp-dhcom-pdk2-overlay-560-200-x12.dts
+++ b/arch/arm64/boot/dts/freescale/imx8mp-dhcom-pdk2-overlay-560-200-x12.dts
@@ -6,6 +6,7 @@
 /plugin/;
 
 #include "imx8mp-dhcom-overlay-panel-dpi.dtsi"
+#include "imx8mp-pinfunc.h"
 
 &{/} {
 	led {
@@ -52,6 +53,13 @@ &panel_in {
 	remote-endpoint = <&tc_bridge_out>;
 };
 
+&pinctrl_dhcom_e {
+	fsl,pins = <
+		/* GPIO_E */
+		MX8MP_IOMUXC_UART1_RXD__GPIO5_IO22 0x40000000
+	>;
+};
+
 &pwm1 {
 	status = "okay";
 };
diff --git a/arch/arm64/boot/dts/freescale/imx8mp-dhcom-pdk2.dts b/arch/arm64/boot/dts/freescale/imx8mp-dhcom-pdk2.dts
index 6109eb51a3d72..0cbbb0c17757e 100644
--- a/arch/arm64/boot/dts/freescale/imx8mp-dhcom-pdk2.dts
+++ b/arch/arm64/boot/dts/freescale/imx8mp-dhcom-pdk2.dts
@@ -11,7 +11,6 @@
 /dts-v1/;
 
 #include <dt-bindings/leds/common.h>
-#include <dt-bindings/phy/phy-imx8-pcie.h>
 #include "imx8mp-dhcom-som.dtsi"
 
 / {
@@ -134,6 +133,65 @@ codec_dai: simple-audio-card,codec {
 			sound-dai = <&sgtl5000>;
 		};
 	};
+
+	sound-hdmi {
+		compatible = "fsl,imx-audio-hdmi";
+		model = "audio-hdmi";
+		audio-cpu = <&aud2htx>;
+		hdmi-out;
+		constraint-rate = <44100>,
+				<88200>,
+				<176400>,
+				<32000>,
+				<48000>,
+				<96000>,
+				<192000>;
+		status = "okay";
+	};
+};
+
+&aud2htx {
+	status = "okay";
+};
+
+&clk {
+	assigned-clocks = <&clk IMX8MP_CLK_A53_SRC>,
+			  <&clk IMX8MP_CLK_A53_CORE>,
+			  <&clk IMX8MP_CLK_NOC>,
+			  <&clk IMX8MP_CLK_NOC_IO>,
+			  <&clk IMX8MP_CLK_GIC>,
+			  <&clk IMX8MP_CLK_AUDIO_AHB>,
+			  <&clk IMX8MP_CLK_AUDIO_AXI_SRC>,
+			  <&clk IMX8MP_CLK_MEDIA_DISP1_PIX>,
+			  <&clk IMX8MP_CLK_MEDIA_AXI>,
+			  <&clk IMX8MP_CLK_MEDIA_APB>,
+			  <&clk IMX8MP_AUDIO_PLL1>,
+			  <&clk IMX8MP_VIDEO_PLL1>;
+	assigned-clock-parents = <&clk IMX8MP_SYS_PLL1_800M>,
+				 <&clk IMX8MP_ARM_PLL_OUT>,
+				 <&clk IMX8MP_SYS_PLL2_1000M>,
+				 <&clk IMX8MP_SYS_PLL1_800M>,
+				 <&clk IMX8MP_SYS_PLL2_500M>,
+				 <&clk IMX8MP_SYS_PLL1_800M>,
+				 <&clk IMX8MP_SYS_PLL1_800M>,
+				 <&clk IMX8MP_VIDEO_PLL1_OUT>,
+				 <&clk IMX8MP_SYS_PLL1_800M>,
+				 <&clk IMX8MP_SYS_PLL1_800M>;
+	assigned-clock-rates = <0>, <0>,
+			       <1000000000>,
+			       <800000000>,
+			       <500000000>,
+			       <400000000>,
+			       <800000000>,
+			       <0>,
+			       <400000000>,
+			       <200000000>,
+			       <393216000>,
+			       <1039500000>;
+};
+
+&dsp {
+	status = "okay";
 };
 
 &i2c5 {
@@ -194,26 +252,46 @@ &flexcan1 {
 	status = "okay";
 };
 
-&hdmi_tx {
+&irqsteer_hdmi {
+	status = "okay";
+};
+
+&hdmi_blk_ctrl {
+	status = "okay";
+};
+
+&hdmi_pavi {
+	status = "okay";
+};
+
+&hdmi {
 	ddc-i2c-bus = <&i2c5>;
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_hdmi>;
 	status = "okay";
 };
 
-&hdmi_tx_phy {
+&hdmiphy {
 	status = "okay";
 };
 
+&lcdif3 {
+	status = "okay";
+
+	thres-low  = <1 2>;             /* (FIFO * 1 / 2) */
+	thres-high = <3 4>;             /* (FIFO * 3 / 4) */
+};
+
 &pcie_phy {
-	fsl,refclk-pad-mode = <IMX8_PCIE_REFCLK_PAD_UNUSED>;
-	clocks = <&clk IMX8MP_SYS_PLL2_100M>;
+	ext_osc = <0>;
 	status = "okay";
 };
 
 &pcie {
 	fsl,max-link-speed = <1>;
 	reset-gpio = <&gpio1 6 GPIO_ACTIVE_LOW>;	/* GPIO J */
+	ext_osc = <0>;
+	status = "okay";
 };
 
 &sai3 {
@@ -227,10 +305,46 @@ &sai3 {
 	status = "okay";
 };
 
+&sdma2 {
+	status = "okay";
+};
+
 &usb3_1 {
 	fsl,over-current-active-low;
 };
 
+&vpu_g1 {
+	status = "okay";
+};
+
+&vpu_g2 {
+	status = "okay";
+};
+
+&vpu_vc8000e {
+	status = "okay";
+};
+
+&vpu_v4l2 {
+	status = "okay";
+};
+
+&gpu_3d {
+	status = "okay";
+};
+
+&gpu_2d {
+	status = "okay";
+};
+
+&ml_vipsi {
+	status = "okay";
+};
+
+&mix_gpu_ml {
+	status = "okay";
+};
+
 &iomuxc {
 	/*
 	 * GPIO_A,B,C,D are connected to buttons.
diff --git a/arch/arm64/boot/dts/freescale/imx8mp-dhcom-som.dtsi b/arch/arm64/boot/dts/freescale/imx8mp-dhcom-som.dtsi
index dd7f5b20a0857..1444abd747d75 100644
--- a/arch/arm64/boot/dts/freescale/imx8mp-dhcom-som.dtsi
+++ b/arch/arm64/boot/dts/freescale/imx8mp-dhcom-som.dtsi
@@ -451,26 +451,29 @@ &mipi_dsi {
 	samsung,burst-clock-frequency = <160000000>;
 	samsung,esc-clock-frequency = <10000000>;
 
+	/delete-node/ port@0;
 	ports {
 		#address-cells = <1>;
 		#size-cells = <0>;
 
+		port@0 {
+			dsim_from_lcdif: endpoint {
+				remote-endpoint = <&lcdif_to_dsim>;
+			};
+		};
+
 		port@1 {
 			reg = <1>;
 
 			dsi_out: endpoint {
 				data-lanes = <1 2 3 4>;
 				remote-endpoint = <&tc_bridge_in>;
+				attach-bridge;
 			};
 		};
 	};
 };
 
-&pcie_phy {
-	fsl,clkreq-unsupported;
-	clock-names = "ref";
-};
-
 &pcie {
 	clocks = <&clk IMX8MP_CLK_HSIO_ROOT>,
 		 <&clk IMX8MP_CLK_PCIE_ROOT>,
@@ -976,14 +979,14 @@ MX8MP_IOMUXC_UART4_TXD__UART4_DCE_TX		0x49
 
 	pinctrl_usb0_vbus: dhcom-usb0-grp {
 		fsl,pins = <
-			MX8MP_IOMUXC_GPIO1_IO10__USB1_OTG_ID		0x0
+			MX8MP_IOMUXC_GPIO1_IO10__USB1_ID		0x0
 		>;
 	};
 
 	pinctrl_usb1_vbus: dhcom-usb1-grp {
 		fsl,pins = <
-			MX8MP_IOMUXC_GPIO1_IO14__USB2_OTG_PWR		0x6
-			MX8MP_IOMUXC_GPIO1_IO15__USB2_OTG_OC		0x80
+			MX8MP_IOMUXC_GPIO1_IO14__USB2_PWR		0x6
+			MX8MP_IOMUXC_GPIO1_IO15__USB2_OC		0x80
 		>;
 	};
 
-- 
2.35.1

