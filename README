This layer provides BSP support for Mainline IMX6 platform.

Dependencies
============

This layer depends on:

  URI: git://git.yoctoproject.org/poky
  branch: dunfell
  layers: meta

  URI: ssh://git@gitlab.denx.de/denx/meta-mainline-common.git
  branch: dunfell-3.1

Building image
==============

A good starting point for setting up the build environment is is the official
Yocto Project wiki.

  https://www.yoctoproject.org/docs/3.1/brief-yoctoprojectqs/brief-yoctoprojectqs.html

Before attempting the build, the following metalayer git repositories shall
be cloned into a location accessible to the build system and a branch listed
below shall be checked out. The examples below will use /path/to/OE/ as a
location of the metalayers.

  ssh://git@gitlab.denx.de/denx/meta-mainline-common.git		dunfell-3.1
  ssh://git@gitlab.denx.de/dh-electronics/meta-dhsom-imx-bsp.git	dunfell-3.1
  git://git.yoctoproject.org/poky					dunfell

With all the source artifacts in place, proceed with setting up the build
using oe-init-build-env as specified in the Yocto Project wiki.

In addition to the content in the wiki, the aforementioned metalayers shall
be referenced in bblayers.conf in this order:

  BBLAYERS ?= " \
    /path/to/OE/poky/meta \
    /path/to/OE/meta-mainline-common \
    /path/to/OE/meta-dhsom-imx-bsp \
    "

The following specifics should be placed into local.conf:

  MACHINE = "dh-imx6-dhcom-pdk2"
  DISTRO = "poky"

Note that MACHINE must be "dh-imx6-dhcom-pdk2" . Adapt the suffixes of
all the files and names of directories further in this documentation
according to MACHINE.

Both local.conf and bblayers.conf are included verbatim in full at the end
of this readme.

Once the configuration is complete, a Qt5 demo system image suitable for
evaluation can be built using:

  $ bitbake core-image-minimal

Once the build completes, the images are available in:

  tmp/deploy/images/dh-imx6-dhcom-pdk2/

The SD card image is specifically in:

  core-image-minimal-dh-imx6-dhcom-pdk2.wic

And shall be written to the SD card using dd:

  $ dd if=core-image-minimal-dh-imx6-dhcom-pdk2.wic of=/dev/sdX bs=8M

Example local.conf
==================
MACHINE = "dh-imx6-dhcom-pdk2"
DL_DIR = "/path/to/OE/downloads"
DISTRO ?= "poky"
PACKAGE_CLASSES ?= "package_rpm"
EXTRA_IMAGE_FEATURES = "debug-tweaks"
USER_CLASSES ?= "buildstats image-mklibs image-prelink"
PATCHRESOLVE = "noop"
BB_DISKMON_DIRS = "\
    STOPTASKS,${TMPDIR},1G,100K \
    STOPTASKS,${DL_DIR},1G,100K \
    STOPTASKS,${SSTATE_DIR},1G,100K \
    STOPTASKS,/tmp,100M,100K \
    ABORT,${TMPDIR},100M,1K \
    ABORT,${DL_DIR},100M,1K \
    ABORT,${SSTATE_DIR},100M,1K \
    ABORT,/tmp,10M,1K"
PACKAGECONFIG_append_pn-qemu-native = " sdl"
PACKAGECONFIG_append_pn-nativesdk-qemu = " sdl"
CONF_VERSION = "1"
BB_NUMBER_THREADS = "12"
PARALLEL_MAKE = "-j 12"
INHERIT += "buildhistory"
BUILDHISTORY_COMMIT = "1"

Example bblayers.conf
=====================
# LAYER_CONF_VERSION is increased each time build/conf/bblayers.conf
# changes incompatibly
POKY_BBLAYERS_CONF_VERSION = "2"

BBPATH = "${TOPDIR}"
BBFILES ?= ""

BBLAYERS ?= " \
	/path/to/OE/poky/meta \
	/path/to/OE/meta-mainline-common \
	/path/to/OE/meta-dhsom-imx-bsp \
	"

BBLAYERS_NON_REMOVABLE ?= " \
	/path/to/OE/poky/meta \
	"
